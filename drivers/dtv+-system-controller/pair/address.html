<!DOCTYPE html>
<html>
<head>
  <style>
    body { padding: 0 20px; font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif; }
    input[type="text"] { width: 100%; padding: 8px; font-size: 16px; border: 1px solid #ccc; border-radius: 4px; box-sizing: border-box; margin: 8px 0 16px; }
    input[type="text"]:focus { outline: none; border-color: #007AFF; }
    button { width: 100%; padding: 10px; font-size: 16px; background: #007AFF; color: #fff; border: none; border-radius: 4px; cursor: pointer; }
    button:disabled { background: #aaa; }
    .error { color: #d32f2f; font-size: 14px; margin-top: 8px; }
    .info  { color: #666; font-size: 14px; }
  </style>
</head>
<body>
  <h2>Connect to Kohler DTV+</h2>
  <p class="info">Enter the IP address of your DTV+ system controller on the local network.</p>
  <label for="address">IP Address</label>
  <input type="text" id="address" placeholder="192.168.1.100" autofocus />
  <button id="btn-connect">Connect</button>
  <p class="error" id="error" style="display:none"></p>

  <script type="application/javascript">
    Homey.ready();

    var btnConnect = document.getElementById('btn-connect');
    var inputAddress = document.getElementById('address');
    var errorEl = document.getElementById('error');

    btnConnect.addEventListener('click', function () {
      var address = inputAddress.value.trim();
      if (!address) return;

      errorEl.style.display = 'none';
      btnConnect.disabled = true;
      btnConnect.textContent = 'Connecting\u2026';

      Homey.emit('address', address)
        .then(function () {
          Homey.showView('list_devices');
        })
        .catch(function (err) {
          btnConnect.disabled = false;
          btnConnect.textContent = 'Connect';
          errorEl.textContent = err.message || 'Could not connect to the DTV+ controller';
          errorEl.style.display = 'block';
        });
    });

    inputAddress.addEventListener('keypress', function (e) {
      if (e.key === 'Enter') btnConnect.click();
    });
  </script>
</body>
</html>
